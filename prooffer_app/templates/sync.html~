<!DOCTYPE html>
<html>
<head>
    <!--<link rel="stylesheet" type="text/css" href="/static/css/style.css"/>-->
</head>
<body style="margin:0px;padding:0px;position:fixed;height:100vh;width:100vw;">
<button style="color:white;margin:0px;padding:0px;background-color:#0b1728" id="dropdownSummary"></button>
<!--
<div class="dropdown">
	<button onclick="dropdown()" class="dropbtn" id="dropdownSummary">Dropdown</button>
	<div id="dropdownContent" class="dropdown-content">
		<a href="#" id="sync_1_status"/> 
		<a href="#" id="sync_2_status"/> 
		<a href="#" id="sync_3_status"/> 
		<a href="#" id="sync_4_status"/> 
		<a href="#" id="sync_5_status"/> 
	</div>
</div>
-->
<script type="text/javascript" src="/static/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript">
	var sync_status_1, sync_status_2, sync_status_3, sync_status_4, sync_status_5;

	window.onload = function(){
		var onclick_triggered = false;
		function click_sync(){
		// onclick function gets triggered on load for some reason so I added this to make sure the method is not called if any of the following variables are still null - meaning the sync process is still not done
			if(![sync_status_1, sync_status_2, sync_status_3, sync_status_4, sync_status_5].some(el => el == null)){
				onclick_triggered = true;				
				alert(`${sync_status_1}\n${sync_status_2}\n${sync_status_3}\n${sync_status_4}\n${sync_status_5}`);
			}
			else {
				if (onclick_triggered){
					alert('Sync ongoing');
				}
				onclick_triggered = true;			
			}
		}
		document.getElementById('dropdownSummary').onclick = click_sync;

	}
	
	var dropDownClick = function(){alert("click")}
	
	var sync = function() {
		var syncedCount = 0;
		var failedSyncCount = 0;
		var isOnline = true;
		$('#dropdownSummary').text('Synchronizing Local and Remote Database...');
		$.ajax({
			type: "GET",
			url: "syncProofferDataDownStream",
			error: function(xhr, status, error){
				failedSyncCount = failedSyncCount + 1;
				if(failedSyncCount == 5){
					$('#dropdownSummary').text('Offline mode');		
				}
				sync_status_1 = `Sync 1 status: ${xhr.responseText.split('\n\n')[0]}`;
				console.log(xhr.responseText.split('\n\n')[0]);	
			},
			success: function(){
				syncedCount = syncedCount + 1;
				$('#dropdownSummary').text('Synced ' + syncedCount + ' of 5');	
				$('#sync_1_status').text('Sync 1 successful');
				sync_status_1 = "Sync 1 successful";			
			}
		});
		
		$.ajax({
			type: "GET",
			url: "syncProofferUsersDownStream",
			error: function(xhr, status, error){
				failedSyncCount = failedSyncCount + 1;
				if(failedSyncCount == 5){
					$('#dropdownSummary').text('Offline mode');		
				}
				sync_status_2 = `Sync 2 status: ${xhr.responseText.split(' ')[0]}`;	
			},
			success: function(){
				syncedCount = syncedCount + 1;
				$('#dropdownSummary').text('Synced ' + syncedCount + ' of 5');	
				$('#sync_2_status').text('Sync 2 successful');	
				sync_status_2 = "Sync 2 successful";					
			}
		});
		
		$.ajax({
			type: "GET",
			url: "syncProofferProjectsDownStream",
			error: function(xhr, status, error){
				failedSyncCount = failedSyncCount + 1;
				if(failedSyncCount == 5){
					$('#dropdownSummary').text('Offline mode');		
				}
				sync_status_3 = `Sync 3 status: ${xhr.responseText.split(' ')[0]}`;		
			},
			success: function(){
				syncedCount = syncedCount + 1;
				$('#dropdownSummary').text('Synced ' + syncedCount + ' of 5');	
				$('#sync_3_status').text('Sync 3 successful');	
				sync_status_3 = "Sync 3 successful";				
			}
		});
		
		$.ajax({
			type: "GET",
			url: "syncProofferUsersUpStream",
			error: function(xhr, status, error){
				failedSyncCount = failedSyncCount + 1;
				if(failedSyncCount == 5){
					$('#dropdownSummary').text('Offline mode');		
				}
				sync_status_4 = `Sync 4 status: ${xhr.responseText.split(' ')[0]}`;		
			},
			success: function(){
				syncedCount = syncedCount + 1;
				$('#dropdownSummary').text('Synced ' + syncedCount + ' of 5');		
				$('#sync_4_status').text('Sync 4 successful');	
				sync_status_4 = "Sync 4 successful";				
			}
		});
		
		$.ajax({
			type: "GET",
			url: "syncProofferProjectsUpStream",
			error: function(xhr, status, error){
				failedSyncCount = failedSyncCount + 1;
				if(failedSyncCount == 5){
					$('#dropdownSummary').text('Offline mode');		
				}
				sync_status_5 = `Sync 5 status: ${xhr.responseText.split(' ')[0]}`;		
			},
			success: function(){
				syncedCount = syncedCount + 1;
				$('#dropdownSummary').text('Synced ' + syncedCount + ' of 5');		
				$('#sync_5_status').text('Sync 5 successful');	
				sync_status_5 = "Sync 5 successful";				
			}
		});
			//error: function(){
			//	$('#sync_status').text('Offline mode');			
			//}
		//})
		//.done(function(response) {
		//	syncedCount = syncedCount + 1;
		//	$('#sync_status').text('Synced ' + syncedCount + ' of 5');
		//});
	};
	sync();
</script>
</body>
</html>
